---
- name: Install and config golang
  include_role:
    name: config-golang

- name: Install master of Packer from source
  shell: |
    set -ex
    make bin
    # Currently, we use ubuntu amd64 image to test, but the make bin failed to
    # find the right version, so in the end of above will fail to copy the
    # binary into /usr/local/bin/
    if [ -d "./pkg/linux_amd64/" ]; then
        cp ./pkg/linux_amd64/packer /usr/local/bin/
    fi
    packer version
  environment: '{{ global_env }}'
  args:
    executable: /bin/bash
    chdir: '{{ zuul.project.src_dir }}'
