# Shared jobs specific to the OpenLab Project

# Common test base job
- job:
    name: init-test
    description: |
      Base job for all types of test jobs. Ensure workspace and copy log files.
    pre-run: playbooks/init-test/pre
    post-run: playbooks/init-test/post

# Golang test base job
- job:
    name: golang-test
    parent: init-test
    description: |
      Base job for all types of golang test jobs.
    pre-run: playbooks/golang-test/pre
    post-run: playbooks/golang-test/post
    vars:
      golang_env:
        GOPATH: '{{ ansible_user_dir }}'
        PATH: '{{ ansible_env.PATH }}:/usr/local/go/bin:{{ ansible_user_dir }}/bin'
        TEST_RESULTS_TXT: '{{ ansible_user_dir }}/workspace/test_results.txt'
        TEST_RESULTS_XML: '{{ ansible_user_dir }}/workspace/test_results.xml'
        TEST_RESULTS_HTML: '{{ ansible_user_dir }}/workspace/test_results.html'

# Golang acceptance test base job
- job:
    name: golang-acceptance-test
    parent: golang-test
    description: |
      Base job for all types of golang acceptance test jobs.
    pre-run: playbooks/golang-acceptance-test/pre
    timeout: 7200

# Gophercloud jobs
- job:
    name: gophercloud-test
    parent: golang-test
    description: |
      Gophercloud test base job
    vars:
      sdk: 'gophercloud'

- job:
    name: gophercloud-unittest
    parent: gophercloud-test
    description: |
      Run gophercloud unit test
    run: playbooks/gophercloud-unittest/run

- job:
    name: gophercloud-acceptance-test-devstack
    parent: gophercloud-test
    description: |
      Run gophercloud acceptance test on master branch with devstack
    run: playbooks/gophercloud-acceptance-test-devstack/run
    vars:
      os_branch: 'master'

- job:
    name: gophercloud-acceptance-test-devstack-pike
    parent: gophercloud-acceptance-test-devstack
    description: |
      Run gophercloud acceptance test on pike branch with devstack
    vars:
      os_branch: 'stable/pike'

- job:
    name: gophercloud-acceptance-test-devstack-ocata
    parent: gophercloud-acceptance-test-devstack
    description: |
      Run gophercloud acceptance test on ocata branch with devstack
    vars:
      os_branch: 'stable/ocata'

- job:
    name: gophercloud-acceptance-test-devstack-newton
    parent: gophercloud-acceptance-test-devstack
    description: |
      Run gophercloud acceptance test on newton branch with devstack
    vars:
      os_branch: 'newton-eol'
    nodeset: ubuntu-trusty

- job:
    name: gophercloud-acceptance-test-devstack-mitaka
    parent: gophercloud-acceptance-test-devstack
    description: |
      Run gophercloud acceptance test on mitaka branch with devstack
    vars:
      os_branch: 'mitaka-eol'
    nodeset: ubuntu-trusty

# Terraform-provider-openstack jobs
- job:
    name: terraform-provider-openstack-unittest
    parent: golang-test
    description: |
      Run terraform provider openstack unit test
    run: playbooks/terraform-provider-openstack-unittest/run

- job:
    name: terraform-provider-openstack-acceptance-test
    parent: golang-acceptance-test
    description: |
      Run terraform provider openstack acceptance test
    run: playbooks/terraform-provider-openstack-acceptance-test/run

- job:
    name: terraform-provider-openstack-acceptance-test-pike
    parent: golang-acceptance-test
    description: |
      Run terraform provider openstack acceptance test with stable/pike OpenStack
    run: playbooks/terraform-provider-openstack-acceptance-test-pike/run

- job:
    name: terraform-provider-openstack-acceptance-test-ocata
    parent: golang-acceptance-test
    description: |
      Run terraform provider openstack acceptance test with stable/ocata OpenStack
    run: playbooks/terraform-provider-openstack-acceptance-test-ocata/run

- job:
    name: terraform-provider-openstack-acceptance-test-newton
    parent: golang-acceptance-test
    description: |
      Run terraform provider openstack acceptance test with stable/newton OpenStack
    run: playbooks/terraform-provider-openstack-acceptance-test-newton/run

- job:
    name: terraform-provider-openstack-acceptance-test-mitaka
    parent: golang-acceptance-test
    description: |
      Run terraform provider openstack acceptance test with stable/mitaka OpenStack
    run: playbooks/terraform-provider-openstack-acceptance-test-mitaka/run
    nodeset: ubuntu-trusty

# Terraform jobs
- job:
    name: terraform-unittest
    parent: golang-test
    description: |
      Run terraform unit test
    run: playbooks/terraform-unittest/run

- job:
    name: terraform-acceptance-test
    parent: golang-acceptance-test
    description: |
      Run terraform acceptance test
    run: playbooks/terraform-acceptance-test/run

# Gophercloud acceptance tests with Telefonica cloud
- job:
    name: gophercloud-telefonica-acceptance-test
    parent: golang-test
    description: |
      Run gophercloud acceptance test with telefonica cloud
    run: playbooks/gophercloud-telefonica-acceptance-test/run
    secrets:
      - telefonica_credentials
